{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": true,
            "basics": {
                "description": "## Microsoft Sentinel Triage AssistanT (STAT) Deployment\nThe Microsoft Sentinel Triage AssistanT is designed to help build automated triages for Microsoft Sentinel Incidents to optimize the efficiency of your security operations. This deployment will allow you to deploy the necessary resources to use the STAT tool.\n ### Post Deployment \nAfter deploying this template, ensure to run the [GrantPermissions.ps1](https://github.com/briandelmsft/SentinelAutomationModules/blob/main/Deploy/GrantPermissions.ps1) script to grant permissions to the STAT modules.  It may take up to 15 minutes for the permissions to become effective.",
                "location": {
                    "label": "Location",
                    "toolTip": "Location for all resources",
                    "resourceTypes": [
                        "Microsoft.Logic"
                    ]
                }
            }
        },
        "basics": [],
        "steps": [
            {
                "name": "idStep",
                "label": "Identity Selector",
                "elements": [
                    {
                        "name": "TextBlock1",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Managed Id Test"
                        }
                    },
                    {
                        "name": "PlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Playbook Name",
                        "placeholder": "",
                        "defaultValue": "ManagedIdPlaybook",
                        "toolTip": "",
                        "constraints": {},
                        "visible": true
                    },
                    {
                        "name": "idType",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Select a type of Managed Identity",
                        "defaultValue": "System Assigned",
                        "toolTip": "",
                        "constraints": {
                          "allowedValues": [
                            {
                              "label": "System Assigned",
                              "value": "SystemAssigned"
                            },
                            {
                              "label": "User Assigned",
                              "value": "UserAssigned"
                            }
                          ],
                          "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "idSelector",
                        "type": "Microsoft.Solutions.ResourceSelector",
                        "label": "Select a User Assigned Managed Identity",
                        "resourceType": "Microsoft.ManagedIdentity/userAssignedIdentities",
                        "options": {
                            "filter": {
                                "subscription": "onBasics",
                                "location": "onBasics"
                            }
                        },
                        "visible": "[if(equals(steps('idStep').idType, 'UserAssigned'), true, false)]"
                    },
                    {
                        "name": "identity",
                        "type": "Microsoft.ManagedIdentity.IdentitySelector",
                        "label": "Managed Identity Configuration",
                        "toolTip": {
                            "systemAssignedIdentity": "Enable system assigned identity to grant the resource access to other existing resources.",
                            "userAssignedIdentity": "Add user assigned identities to grant the resource access to other existing resources."
                        },
                        "defaultValue": {
                            "systemAssignedIdentity": "Off"
                        },
                        "options": {
                            "hideSystemAssignedIdentity": false,
                            "hideUserAssignedIdentity": false
                        },
                        "visible": false
                    }
                ]
            }
        ],
        "outputs": {
            "PlaybookName": "[steps('idStep').PlaybookName]",
            "IdentityType": "[steps('idStep').idType]",
            "UserIdentityResourceId": "[steps('idStep').idSelector.id]",
            "location": "[location()]"
        }
    }
}
