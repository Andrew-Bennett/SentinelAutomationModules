{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": true,
            "basics": {
                "description": "## Microsoft Sentinel Triage AssistanT (STAT) Deployment\nThe Microsoft Sentinel Triage AssistanT is designed to help build automated triages for Microsoft Sentinel Incidents to optimize the efficiency of your security operations. This deployment will allow you to deploy the necessary resources to use the STAT tool.\n ### Post Deployment \nAfter deploying this template, ensure to run the [GrantPermissions.ps1](https://github.com/briandelmsft/SentinelAutomationModules/blob/main/Deploy/GrantPermissions.ps1) script to grant permissions to the STAT modules.  It may take up to 15 minutes for the permissions to become effective.",
                "location": {
                    "label": "Location",
                    "toolTip": "Location for all resources",
                    "resourceTypes": [
                        "Microsoft.Logic"
                    ]
                }
            }
        },
        "basics": [],
        "steps": [
            {
                "name": "deploymentTypeStep",
                "label": "Deployment Type",
                "elements": [
                    {
                        "name": "deployTextBlock1",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Placeholder - This page has no functionality right now"
                        }
                    },
                    {
                        "name": "deployTextBlock2",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select the type of deployment you want for the Sentinel Triage AssistanT"
                        }
                    },
                    {
                        "name": "deployTextBlock3",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "A standard deployment allows you to deploy or update the entire STAT solution with minimal input.  An advanced deployment allows for additional configuration such as providing customized names to the Logic Apps",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Deploy"
                            }
                        }
                    },
                    {
                        "name": "deploymentType",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Select the deloyment type",
                        "defaultValue": "Standard (recommended)",
                        "toolTip": "",
                        "constraints": {
                          "allowedValues": [
                            {
                              "label": "Standard (recommended)",
                              "value": "standard"
                            },
                            {
                              "label": "Advanced",
                              "value": "advanced"
                            }
                          ],
                          "required": true
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "automationModules",
                "label": "STAT Setup",
                "elements": [
                    {
                        "name": "standardSetup",
                        "type": "Microsoft.Common.Section",
                        "label": "Standard Setup - STAT",
                        "elements": [
                            {
                                "name": "textBlock1",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "Please select which automation modules you want to deloy",
                                    "link": {
                                        "label": "Learn more",
                                        "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Modules"
                                    }
                                }
                            },
                            {
                                "name": "enableModulesKind",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Select Automation Modules to onboard",
                                "placeholder": "",
                                "multiselect": true,
                                "defaultValue": "",
                                "toolTip": "Select the Automation modules you would like to deploy.",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "Azure AD Risks Module",
                                            "value": "AADModule"
                                        },
                                        {
                                            "label": "File Module",
                                            "value": "FileModule"
                                        },
                                        {
                                            "label": "KQL Module",
                                            "value": "KQLModule"
                                        },
                                        {
                                            "label": "MCAS Module",
                                            "value": "MCASModule"
                                        },
                                        {
                                            "label": "MDE Module",
                                            "value": "MDEModule"
                                        },
                                        {
                                            "label": "Out of Office Module",
                                            "value": "OOFModule"
                                        },
                                        {
                                            "label": "Related Alerts Module",
                                            "value": "RelatedAlerts"
                                        },
                                        {
                                            "label": "Threat Intelligence Module",
                                            "value": "TIModule"
                                        },
                                        {
                                            "label": "UEBA Module",
                                            "value": "UEBAModule"
                                        },
                                        {
                                            "label": "Watchlist Module",
                                            "value": "WatchlistModule"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            },
                            {
                                "name": "DeploySamplePlaybook",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Deploy the Sample Incident Triage Playbook",
                                "defaultValue": false,
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'))]"
                            },
                            {
                                "name": "SamplePlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Sample Triage Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Triage-Incident",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'),steps('automationModules').DeploySamplePlaybook)]"
                            },
                            {
                                "name": "DeployConnector",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Deploy the STAT Logic Apps Custom Connector",
                                "defaultValue": true,
                                "toolTip": "",
                                "constraints": {}
                            }
        
                        ],
                        "visible": "[if(equals(steps('deploymentTypeStep').deploymentType, 'standard'), true, false)]"
                    },
                    {
                        "name": "advancedSetup",
                        "type": "Microsoft.Common.Section",
                        "label": "Advanced Setup - STAT",
                        "elements": [
                            {
                                "name": "textBlock1",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "Please select which automation modules you want to deloy",
                                    "link": {
                                        "label": "Learn more",
                                        "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Modules"
                                    }
                                }
                            },
                            {
                                "name": "enableModulesKind",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Select Automation Modules to onboard",
                                "placeholder": "",
                                "multiselect": true,
                                "defaultValue": "",
                                "toolTip": "Select the Automation modules you would like to deploy.",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "Azure AD Risks Module",
                                            "value": "AADModule"
                                        },
                                        {
                                            "label": "File Module",
                                            "value": "FileModule"
                                        },
                                        {
                                            "label": "KQL Module",
                                            "value": "KQLModule"
                                        },
                                        {
                                            "label": "MCAS Module",
                                            "value": "MCASModule"
                                        },
                                        {
                                            "label": "MDE Module",
                                            "value": "MDEModule"
                                        },
                                        {
                                            "label": "Out of Office Module",
                                            "value": "OOFModule"
                                        },
                                        {
                                            "label": "Related Alerts Module",
                                            "value": "RelatedAlerts"
                                        },
                                        {
                                            "label": "Threat Intelligence Module",
                                            "value": "TIModule"
                                        },
                                        {
                                            "label": "UEBA Module",
                                            "value": "UEBAModule"
                                        },
                                        {
                                            "label": "Watchlist Module",
                                            "value": "WatchlistModule"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            },
                            {
                                "name": "BasePlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Base Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Base-Module",
                                "toolTip": "",
                                "constraints": {}
                            },
                            {
                                "name": "AADRisksPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Azure AD Risks Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-AADUserRisksInfo",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'AADModule'), true, false)]"
                            },
                            {
                                "name": "FilePlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "File Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-FileInsights",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'FileModule'), true, false)]"
                            },
                            {
                                "name": "KQLPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "KQL Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Run-KQLQuery",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'KQLModule'), true, false)]"
                            },
                            {
                                "name": "OOFPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Out Of Office Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-OOFDetails",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'OOFModule'), true, false)]"
                            },
                            {
                                "name": "RelatedAlertsPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Related Alerts Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-RelatedAlerts",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'RelatedAlerts'), true, false)]"
                            },
                            {
                                "name": "TIPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Threat Intelligence Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-ThreatIntel",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'TIModule'), true, false)]"
                            },
                            {
                                "name": "UEBAPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "UEBA Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-UEBAInsights",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'UEBAModule'), true, false)]"
                            },
                            {
                                "name": "MDEPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "MDE Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-MDEUsersDevicesRiskScore",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'MDEModule'), true, false)]"
                            },
                            {
                                "name": "WatchlistPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Watchlist Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-WatchlistInsights",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'WatchlistModule'), true, false)]"
                            },
                            {
                                "name": "MCASPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "MCAS Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Get-MCASInvestigationScore",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[if(contains(steps('automationModules').enableModulesKind,'MCASModule'), true, false)]"
                            },
                            {
                                "name": "DeploySamplePlaybook",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Deploy the Sample Incident Triage Playbook",
                                "defaultValue": false,
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'))]"
                            },
                            {
                                "name": "SamplePlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Sample Triage Playbook Name",
                                "placeholder": "",
                                "defaultValue": "Triage-Incident",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'),steps('automationModules').DeploySamplePlaybook)]"
                            },
                            {
                                "name": "DeployConnector",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Deploy the STAT Logic Apps Custom Connector",
                                "defaultValue": true,
                                "toolTip": "",
                                "constraints": {}
                            },
                            {
                                "name": "STATCoordinatorPlaybookName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "STAT Coordinator Playbook Name",
                                "placeholder": "",
                                "defaultValue": "STAT-Coordinator",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[steps('automationModules').DeployConnector]"
                            },
                            {
                                "name": "CustomConnectorName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "STAT Logic Apps Connector Name",
                                "placeholder": "",
                                "defaultValue": "SentinelTriageAssistant",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[steps('automationModules').DeployConnector]"
                            },
                            {
                                "name": "CustomConnectorDisplayName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "STAT Logic Apps Connector Display Name",
                                "placeholder": "",
                                "defaultValue": "Sentinel Triage AssistanT - STAT",
                                "toolTip": "",
                                "constraints": {},
                                "visible": "[steps('automationModules').DeployConnector]"
                            }
        
                        ],
                        "visible": "[if(equals(steps('deploymentTypeStep').deploymentType, 'advanced'), true, false)]"
                    }
                ]
            },
            {
                "name": "sampleStep",
                "label": "Sample Deployment",
                "elements": [
                    {
                        "name": "sampleTextBlock1",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Placeholder - For deployment of samples"
                        }
                    },
                    {
                        "name": "sampleTextBlock2",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "a"
                        }
                    },
                    {
                        "name": "sampleTextBlock3",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "a",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Samples"
                            }
                        }
                    }
                ]
            }
        ],
        "outputs": {
            "enableModulesKind": "[coalesce(steps('automationModules').advancedSetup.enableModulesKind,steps('automationModules').standardSetup.enableModulesKind)]",
            "OOFPlaybookName": "[coalesce(steps('automationModules').advancedSetup.OOFPlaybookName,'Get-OOFDetails')]",
            "RelatedAlertsPlaybookName": "[coalesce(steps('automationModules').advancedSetup.RelatedAlertsPlaybookName,'Get-RelatedAlerts')]",
            "TIPlaybookName": "[coalesce(steps('automationModules').advancedSetup.TIPlaybookName,'Get-ThreatIntel')]",
            "UEBAPlaybookName": "[coalesce(steps('automationModules').advancedSetup.UEBAPlaybookName,'Get-UEBAInsights')]",
            "FilePlaybookName": "[coalesce(steps('automationModules').advancedSetup.FilePlaybookName,'Get-FileInsights')]",
            "KQLPlaybookName": "[coalesce(steps('automationModules').advancedSetup.KQLPlaybookName,'Run-KQLQuery')]",
            "BasePlaybookName": "[coalesce(steps('automationModules').advancedSetup.BasePlaybookName,'Base-Module')]",
            "AADRisksPlaybookName": "[coalesce(steps('automationModules').advancedSetup.AADRisksPlaybookName,'Get-AADUserRisksInfo')]",
            "MDEPlaybookName": "[coalesce(steps('automationModules').advancedSetup.MDEPlaybookName,'Get-MDEUsersDevicesRiskScore')]",
            "MCASPlaybookName": "[coalesce(steps('automationModules').advancedSetup.MCASPlaybookName,'Get-MCASInvestigationScore')]",
            "WatchlistPlaybookName": "[coalesce(steps('automationModules').advancedSetup.WatchlistPlaybookName,'Get-WatchlistInsights')]",
            "DeploySamplePlaybook": "[coalesce(steps('automationModules').advancedSetup.DeploySamplePlaybook,steps('automationModules').standardSetup.DeploySamplePlaybook)]",
            "SamplePlaybookName": "[coalesce(steps('automationModules').advancedSetup.SamplePlaybookName,steps('automationModules').standardSetup.SamplePlaybookName)]",
            "STATCoordinatorPlaybookName": "[coalesce(steps('automationModules').advancedSetup.STATCoordinatorPlaybookName,'STAT-Coordinator')]",
            "CustomConnectorName": "[coalesce(steps('automationModules').advancedSetup.CustomConnectorName,'SentinelTriageAssistant')]",
            "CustomConnectorDisplayName": "[coalesce(steps('automationModules').advancedSetup.CustomConnectorDisplayName,'Sentinel Triage AssistanT - STAT')]",
            "DeployConnector": "[coalesce(steps('automationModules').advancedSetup.DeployConnector,steps('automationModules').standardSetup.DeployConnector)]",
            "StandardSetup": "[if(equals(steps('deploymentTypeStep').deploymentType, 'standard'), true, false)]",
            "location": "[location()]"
        }
    }
}
