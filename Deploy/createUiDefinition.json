{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": true,
            "basics": {
                "description": "## Microsoft Sentinel Triage AssistanT (STAT) Deployment\nThe Microsoft Sentinel Triage AssistanT is designed to help build automated triages for Microsoft Sentinel Incidents to optimize the efficiency of your security operations. This deployment will allow you to deploy the necessary resources to use the STAT tool.\n ### Post Deployment \nAfter deploying this template, ensure to run the [GrantPermissions.ps1](https://github.com/briandelmsft/SentinelAutomationModules/blob/main/Deploy/GrantPermissions.ps1) script to grant permissions to the STAT modules.  It may take up to 15 minutes for the permissions to become effective.",
                "location": {
                    "label": "Location",
                    "toolTip": "Location for all resources",
                    "resourceTypes": [
                        "Microsoft.Logic"
                    ]
                }
            }
        },
        "basics": [],
        "steps": [
            {
                "name": "deploymentType",
                "label": "Deployment Type",
                "elements": [
                    {
                        "name": "textBlock1",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Placeholder - This page has no functionality right now"
                        }
                    },
                    {
                        "name": "textBlock2",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select the type of deployment you want for the Sentinel Triage AssistanT.<br>A <b>standard</b> deployment allows you to deploy or update the entire STAT solution with minimal input.  An <b>advanced</b> deployment allows for additional configuration such as providing customized names to the Logic Apps",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Deploy"
                            }
                        }
                    },
                    {
                        "name": "DeploymentType",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Select the deloyment type",
                        "defaultValue": "Standard (recommended)",
                        "toolTip": "",
                        "constraints": {
                          "allowedValues": [
                            {
                              "label": "Standard (recommended)",
                              "value": "standard"
                            },
                            {
                              "label": "Advanced",
                              "value": "advanced"
                            }
                          ],
                          "required": true
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "automationModules",
                "label": "Automation Modules",
                "elements": [
                    {
                        "name": "textBlock1",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Please select which automation modules you want to deloy",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://github.com/briandelmsft/SentinelAutomationModules/tree/main/Modules"
                            }
                        }
                    },
                    {
                        "name": "enableModulesKind",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Select Automation Modules to onboard",
                        "placeholder": "",
                        "multiselect": true,
                        "defaultValue": "",
                        "toolTip": "Select the Automation modules you would like to deploy.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Azure AD Risks Module",
                                    "value": "AADModule"
                                },
                                {
                                    "label": "File Module",
                                    "value": "FileModule"
                                },
                                {
                                    "label": "KQL Module",
                                    "value": "KQLModule"
                                },
                                {
                                    "label": "MCAS Module",
                                    "value": "MCASModule"
                                },
                                {
                                    "label": "MDE Module",
                                    "value": "MDEModule"
                                },
                                {
                                    "label": "Out of Office Module",
                                    "value": "OOFModule"
                                },
                                {
                                    "label": "Related Alerts Module",
                                    "value": "RelatedAlerts"
                                },
                                {
                                    "label": "Threat Intelligence Module",
                                    "value": "TIModule"
                                },
                                {
                                    "label": "UEBA Module",
                                    "value": "UEBAModule"
                                },
                                {
                                    "label": "Watchlist Module",
                                    "value": "WatchlistModule"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "BasePlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Base Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Base-Module",
                        "toolTip": "",
                        "constraints": {}
                    },
                    {
                        "name": "AADRisksPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure AD Risks Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-AADUserRisksInfo",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'AADModule'), true, false)]"
                    },
                    {
                        "name": "FilePlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "File Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-FileInsights",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'FileModule'), true, false)]"
                    },
                    {
                        "name": "KQLPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "KQL Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Run-KQLQuery",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'KQLModule'), true, false)]"
                    },
                    {
                        "name": "OOFPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Out Of Office Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-OOFDetails",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'OOFModule'), true, false)]"
                    },
                    {
                        "name": "RelatedAlertsPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Related Alerts Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-RelatedAlerts",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'RelatedAlerts'), true, false)]"
                    },
                    {
                        "name": "TIPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Threat Intelligence Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-ThreatIntel",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'TIModule'), true, false)]"
                    },
                    {
                        "name": "UEBAPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "UEBA Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-UEBAInsights",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'UEBAModule'), true, false)]"
                    },
                    {
                        "name": "MDEPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "MDE Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-MDEUsersDevicesRiskScore",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'MDEModule'), true, false)]"
                    },
                    {
                        "name": "WatchlistPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Watchlist Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-WatchlistInsights",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'WatchlistModule'), true, false)]"
                    },
                    {
                        "name": "MCASPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "MCAS Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Get-MCASInvestigationScore",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'MCASModule'), true, false)]"
                    },
                    {
                        "name": "MCASAPIKEY",
                        "type": "Microsoft.Common.TextBox",
                        "label": "MCAS API Key",
                        "placeholder": "Enter the API Key obtained from MCAS",
                        "defaultValue": "",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'MCASModule'), true, false)]"
                    },
                    {
                        "name": "MCASAPIURL",
                        "type": "Microsoft.Common.TextBox",
                        "label": "MCAS API URL",
                        "placeholder": "Enter the API URL obtained from MCAS",
                        "defaultValue": "",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[if(contains(steps('automationModules').enableModulesKind,'MCASModule'), true, false)]"
                    },
                    {
                        "name": "DeploySamplePlaybook",
                        "type": "Microsoft.Common.CheckBox",
                        "label": "Deploy the Sample Incident Triage Playbook",
                        "defaultValue": false,
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'))]"
                    },
                    {
                        "name": "SamplePlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Sample Triage Playbook Name",
                        "placeholder": "",
                        "defaultValue": "Triage-Incident",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[and(contains(steps('automationModules').enableModulesKind,'OOFModule'),contains(steps('automationModules').enableModulesKind,'RelatedAlerts'),contains(steps('automationModules').enableModulesKind,'UEBAModule'),steps('automationModules').DeploySamplePlaybook)]"
                    },
                    {
                        "name": "DeployConnector",
                        "type": "Microsoft.Common.CheckBox",
                        "label": "Deploy the Logic Apps Custom Connector",
                        "defaultValue": true,
                        "toolTip": "",
                        "constraints": {}
                    },
                    {
                        "name": "STATCoordinatorPlaybookName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "STAT Coordinator Playbook Name",
                        "placeholder": "",
                        "defaultValue": "STAT-Coordinator",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[steps('automationModules').DeployConnector]"
                    },
                    {
                        "name": "CustomConnectorName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Custom Logic Apps Connector Name",
                        "placeholder": "",
                        "defaultValue": "SentinelTriageAssistant",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[steps('automationModules').DeployConnector]"
                    },
                    {
                        "name": "CustomConnectorDisplayName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Custom Logic Apps Connector Display Name",
                        "placeholder": "",
                        "defaultValue": "Sentinel Triage AssistanT - STAT",
                        "toolTip": "",
                        "constraints": {},
                        "visible": "[steps('automationModules').DeployConnector]"
                    }
                ]
            }
        ],
        "outputs": {
            "enableModulesKind": "[steps('automationModules').enableModulesKind]",
            "OOFPlaybookName": "[steps('automationModules').OOFPlaybookName]",
            "RelatedAlertsPlaybookName": "[steps('automationModules').RelatedAlertsPlaybookName]",
            "TIPlaybookName": "[steps('automationModules').TIPlaybookName]",
            "UEBAPlaybookName": "[steps('automationModules').UEBAPlaybookName]",
            "FilePlaybookName": "[steps('automationModules').FilePlaybookName]",
            "KQLPlaybookName": "[steps('automationModules').KQLPlaybookName]",
            "BasePlaybookName": "[steps('automationModules').BasePlaybookName]",
            "AADRisksPlaybookName": "[steps('automationModules').AADRisksPlaybookName]",
            "MDEPlaybookName": "[steps('automationModules').MDEPlaybookName]",
            "MCASPlaybookName": "[steps('automationModules').MCASPlaybookName]",
            "WatchlistPlaybookName": "[steps('automationModules').WatchlistPlaybookName]",
            "MCAS API KEY": "[steps('automationModules').MCASAPIKEY]",
            "MCAS API URL": "[steps('automationModules').MCASAPIURL]",
            "DeploySamplePlaybook": "[steps('automationModules').DeploySamplePlaybook]",
            "SamplePlaybookName": "[steps('automationModules').SamplePlaybookName]",
            "STATCoordinatorPlaybookName": "[steps('automationModules').STATCoordinatorPlaybookName]",
            "CustomConnectorName": "[steps('automationModules').CustomConnectorName]",
            "CustomConnectorDisplayName": "[steps('automationModules').CustomConnectorDisplayName]",
            "DeployConnector": "[steps('automationModules').DeployConnector]",
            "location": "[location()]"
        }
    }
}
